-- Test page advance with upper bound checking
-- Targets lines 3247-3254: page doesn't match bounds, stop scan
SET client_min_messages = warning;
CREATE EXTENSION IF NOT EXISTS smol;
SET enable_seqscan = off;
SET enable_bitmapscan = off;
SET max_parallel_workers_per_gather = 0;
-- Create table that will have multiple pages
DROP TABLE IF EXISTS t_bounds CASCADE;
CREATE UNLOGGED TABLE t_bounds (k int4);
-- Insert enough data to create multiple pages
-- Each page holds ~400 rows for int4 keys
INSERT INTO t_bounds SELECT i FROM generate_series(1, 10000) i;
ALTER TABLE t_bounds SET (autovacuum_enabled = off);
VACUUM (FREEZE, ANALYZE) t_bounds;
CREATE INDEX t_bounds_idx ON t_bounds USING smol(k);
-- Verify we have multiple pages
SELECT total_pages, leaf_pages FROM smol_inspect('t_bounds_idx');
 total_pages | leaf_pages 
-------------+------------
          11 |          8
(1 row)

-- Query with upper bound that causes page-level bounds check to stop scan
-- The page advance logic checks if first key > upper bound
SELECT count(*) FROM t_bounds WHERE k <= 100;
 count 
-------
   100
(1 row)

-- Cleanup
DROP TABLE t_bounds CASCADE;
